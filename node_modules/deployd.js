var EventEmitter = require('events').EventEmitter
  // deployd is just an event emitter
  , dpd = module.exports = new EventEmitter()
  , fs = require('fs')
;

// deployd entry point
console.info('deployd has started');

// get package.json
fs.readFile('./package.json', function(err, data) {
  var config;
  
  try {
    config = JSON.parse(data);
  } catch(e) {
    console.error(e);
    console.warn('invalid JSON in package.json');
    process.exit();
  }
  
  load(config);
});

// require all dependencies
function load(config) {
  Object.keys(config.dependencies).forEach(function(module) {
    try {
      require(module);
    } catch(e) {
      console.error('could not find the', module, 'module... run npm update!');
      process.exit();
    }
  });
  
  // tell every module dpd is ready
  dpd.emit('ready', config);
}

