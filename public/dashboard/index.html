<!doctype html>
<html xmlns:fb="http://ogp.me/ns/fb#">
<head>
  <meta charset="utf-8">
  <title>Deployd :: Dashboard</title>
  <link rel="stylesheet" media="all" href="css/dashboard.css" />
</head>

<body>
  <header class="top-level">
    <h1>MyApp Dashboard</h1>
    <a href="#" class="sign-out">sign out</a>
  </header>
  <section class="app-admin">
    <ul role="navigation" id="appNav">
      <li><a href="#/">Config</a></li>
      <li><a href="#/plugins">Plugins</a>
        <ul>
          <li><a href="#/plugins/1">Users</a></li>
        </ul>
      </li>
      <li><a href="#/models">Models</a></li>
    </ul>
    <div id="content"><strong>Loading...</strong></div>
  </section>
  
  <!-- PARTIAL TEMPLATES -->

  <script id="app-detail-template" type="html/template">
    <div>App Name: <%= name %></div>
  </script>
  <script id="app-nav-template" type="html/template">
    <li><a href="#/">Config</a></li>
    <li><a href="#/plugins">Plugins</a>
      <ul>
        <% _.each(plugins.models, function (plugin) { %>
          <li><a href="#/plugins/<%= plugin.attributes._id %>"><%= plugin.attributes.name %></a></li>
        <% }); %>
      </ul>
    </li>
    <li>
      <a>Reference</a>
    </li>
  </script>
  <script id="model-detail-template" type="html/template">
    <div><%= name %></div>
  </script>
  <script id="plugin-form-template" type="html/template">
    
    <form action="<%= action %>" method="<%= method %>" onsubmit="return false;">
    <% _.each(fields, function (form_field) { %>
      <div class="form-row">
        <label for="<%= form_field.name %>"><%= form_field.label %></label>
        <input name="<%= form_field.name %>" type="<%= form_field.type %>" <% if (form_field.required) { %> required="true" <%; } %> />
      </div>
    <% }); %>
    <input type="submit" value="Submit" />
    </form>

  </script>
  <script id="plugin-datalist-template" type="html/template">
    <table>    
      <thead>
        <tr>
          <% for (attribute in dataItems[0]) { 
            if (dataItems[0].hasOwnProperty(attribute)) {
            %>
              <th><%= attribute =></th>
            <% } 
            }
          %>
        </tr>
      </thead>
      <% _.each(dataItems, function (dataItem) { %>
        <tr>
          <% for (column in dataItem) {
            if (dataItem.hasOwnProperty(column)) { %>
              <td><%= dataItem.column %></td>
          <%  }
          } %>
          
        </tr>
      <% });%>
    </table>
    
  </script>
  <script id="plugin-detail-template" type="html/template">
    <header>
      <h2>
        <em><%= name %></em> Plugin
      </h2>
      <ul class="plugin-nav">
        <li class="active"><a href="<%= url %>">Overview</a></li>
        <% _.each(configurable_objects, function (navItem) { %>
          <li class="<% 
            var className = 'context' + navItem.id;
            while (className.indexOf(' ') > -1) {
              className = className.replace(' ', '');
            }
            %><%= className %>"><a href="<%= url %>/<%= navItem.id %>"><%= navItem.name %></a></li>
        <% }); %>
      </ul>
    </header>
    
    <div class="substance"><%= overview_html %></div>
  </script>
  
  <script id="model-item-template" type="html/template">
    <%= name %> Model
  </script>
  <script id="plugin-item-template" type="html/template">
    <%= name %> Plugin
  </script>

  <!-- END PARTIAL TEMPLATES -->
  
  <script src="js/libs/LAB.js"></script>
  <script>
  (function() {
    var l = 'js/libs/', m = 'js/model/', v = 'js/view/', p = 'js/view/partial/';
    // dependencies
    $LAB
    .setOptions({
      AlwaysPreserveOrder: true,
      CacheBust: true
    })
    .script(l + 'underscore-min.js')
    .script(l + 'jquery-1.6.2.js')
	.script('/deployd.js')
    .wait()
    .script(l + 'backbone.js')
    .script(l + 'json.min.js')
    .script(l + 'jquery.cookie.js')
    // model
    .script(m + 'app.js')
    .script(m + 'list.js')
    .script(m + 'data-list.js')
    .script(m + 'plugin.js')
    .script(m + 'search.js')
    .script(m + 'dashboard.js')
    .script(m + 'form.js')
    .script(m + 'model.js')
    // partials
    .script(v + 'view.js')
    .script(p + 'app-view.js')
    .script(p + 'list-view.js')
    .script(p + 'model-view.js')
    .script(p + 'plugin-view.js')
    .script(p + 'form-view.js')
    // views
    .script(v + 'dashboard-view.js')
    .script(v + 'app-nav-view.js')
    // router
    .script('js/router.js');
    })();
    </script>
  </body>
</html>
