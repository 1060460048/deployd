<!doctype html>
<html xmlns:fb="http://ogp.me/ns/fb#">
<head>
  <meta charset="utf-8">
  <title>Deployd :: Dashboard</title>
  <link rel="stylesheet" media="all" href="/dashboard/css/dashboard.css" />
</head>

<body>
  <div id="nav">
		<div class="row">
			<div class="three columns">
				<h1>Deployd</h1>
			</div>
		</div>
	</div>
	
	<!-- container -->
	<div class="container">
		<div class="row">
			<form class="nice five columns centered">
				<div class="row">
				  <h2 class="three columns">
  				  Login
  				</h2>
  			  <h5 class="six columns" style="position: relative; top: 17px;">
  			    or <a href="/register.html">Join for Free</a>
  			  </h5>
			  </div>
				<div id="info" class="panel">
				  <label>Email</label>
  				<input id="email" type="text" class="oversize input-text" />
  				<label>Password</label>
  				<input id="password" type="password" class="oversize input-text" />
  				<a id="login-btn" class="small radius nice blue button">Login</a>
  			</div>
			</form>
		</div>
	</div>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script src="/deployd.js"></script>
	
	<script>
		function query(name) {
		  name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
		  var regexS = "[\\?&]" + name + "=([^&#]*)";
		  var regex = new RegExp(regexS);
		  var results = regex.exec(window.location.href);
		  if(results == null)
		    return "";
		  else
		    return decodeURIComponent(results[1].replace(/\+/g, " "));
		}
	
		$('#login-btn, #register-btn').click(function() {
			var email = $('#email').val(),
				password = $('#password').val(),
				user = {email: email, password: password}
				redirect = query('redirect') || '/dashboard';
			
			if(email && password) {
				if($(this).attr('id') == 'register-btn') {
					dpd('/users', user, function(res) {
						if(!res.errors) {
							dpd('/users/login', user, function(res) {
								if(res.errors) {
									alert(res.errors[0].message);
								} else {
    							window.location = '/dashboard';
								}
							});
						} else {
							alert(res.errors[0].message);
						}
					});
				} else {
					dpd('/users/login', user, function(res) {
						if(!res.errors && res._id) {
							window.location = redirect;
						} else {
							alert(res.errors[0] && res.errors[0].message);
						}
					});
				}
			}
		});
	</script>
	
  </body>
</html>
