<!doctype html>
<html xmlns:fb="http://ogp.me/ns/fb#">
<head>
  <meta charset="utf-8">
  <title>Deployd :: Dashboard</title>
  <link rel="stylesheet" media="all" href="/dashboard/css/dashboard.css" />
</head>

<body>
  <div id="nav">
		<div class="row">
			<div class="three columns">
				<h1>Deployd</h1>
			</div>
		</div>
	</div>
	
	<!-- container -->
	<div class="container">
		<div class="row">
			<form class="nice five columns centered">
			  <h2>
				  Register
				</h2>
				<div id="panel" class="panel">
				  <label>Email</label>
  				<input id="email" type="text" class="oversize input-text" />
  				<label>Password</label>
  				<input id="password" type="password" class="oversize input-text" />
  				<a id="register-btn" class="small radius nice blue button">Create an Account</a>
  			</div>
			</form>
		</div>
	</div>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script src="/deployd.js"></script>
	
	<script>
		$('#login-btn, #register-btn').click(function() {
			var email = $('#email').val(),
				password = $('#password').val(),
				user = {email: email, password: password};
				
			if(email && password) {
				if($(this).attr('id') == 'register-btn') {
					dpd('/users', user, function(res) {
						if(!res.errors) {
						  
						  $('#panel').text('Logging you in...');
						  
							dpd('/users/login', user, function(res) {
								if(res.errors) {
									alert(res.errors[0].message);
								} else {
    						  window.location = '/dashboard';
								}
							});
						} else {
							alert(res.errors[0].message);
						}
					});
				} else {
					dpd('/users/login', user, function(res) {
						if(!res.errors && res._id) {
							window.location = '/dashboard';
						} else {
							alert(res.errors[0] && res.errors[0].message);
						}
					});
				}
			}
		});
	</script>
	
  </body>
</html>
