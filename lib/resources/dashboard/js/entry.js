define("model/property",["require","exports","module"],function(require,exports,module){var Property=module.exports=Backbone.Model.extend({defaults:{required:!1},parse:function(json){return json.$renameFrom=json.name,json},toJSON:function(){var json=Backbone.Model.prototype.toJSON.call(this);return json.$renameFrom=json.$renameFrom||json.id,json.$renameFrom==json.name&&delete json.$renameFrom,json}})}),define("model/property-collection",["require","exports","module","./property"],function(require,exports,module){var Property=require("./property"),PropertyCollection=module.exports=Backbone.Collection.extend({model:Property,comparator:function(prop){return prop.get("order")}})}),define("model/collection-settings",["require","exports","module","./property-collection"],function(require,exports,module){var PropertyCollection=require("./property-collection"),CollectionSettings=module.exports=Backbone.Model.extend({url:function(){return"/__resources/"+this.id},defaults:{properties:null,onGet:"",onPost:'/* Authentication */\n// if (!me || !me.isAdmin) {\n//   cancel("You must be an admin!", 401);\n// }\n\n/* Automatic properties */\n// this.creator = me.id;\n// this.creatorName = me.name;\n',onPut:'/* Readonly properties */\n// protect("creator");\n',onDelete:"",onValidate:'/* Validation */\n// if (this.name.length < 10) {\n//   error("name", "Must be at least 10 characters");\n// }\n'},initialize:function(){this.set({properties:new PropertyCollection}),this.get("properties").on("add",this.triggerChanged,this),this.get("properties").on("remove",this.triggerChanged,this),this.get("properties").on("update",this.triggerChanged,this),this.get("properties").on("change:name",this.triggerChanged,this),this.get("properties").on("change:required",this.triggerChanged,this),this.get("properties").on("change:order",this.triggerChanged,this)},parse:function(json){var properties=json.properties;return delete json.properties,this.get("properties").each(function(prop){var newProp=properties[prop.get("name")];newProp&&_.each(prop.attributes,function(value,key){_.str.startsWith(key,"c_")&&(newProp[key]=value)})}),properties&&this.get("properties").reset(Backbone.Utils.parseDictionary(properties,{keyProperty:"name"}),{parse:!0}),json},triggerChanged:function(){this.trigger("change")},toJSON:function(){var json=Backbone.Model.prototype.toJSON.call(this);return json.properties=Backbone.Utils.toJSONDictionary(json.properties.toJSON(),{keyProperty:"name"}),json}})}),define("app",["require","exports","module","./model/collection-settings"],function(require,exports,module){var CollectionSettings=require("./model/collection-settings"),App=Backbone.Model.extend({defaults:{appName:"My App",appUrl:"",resourceType:"",files:undefined},initialize:function(){this.on("change:resourceTypeId",this.setDocLink,this),this.on("change:resourceId",this.loadResource,this),this.on("change:authKey",function(){var authKey=this.get("authKey");authKey?$.cookie("DPDAuthKey",authKey,{expires:7}):$.cookie("DPDAuthKey",null)},this),this.set({appUrl:location.protocol+"//"+location.host,authKey:$.cookie("DPDAuthKey")}),this.setDocLink()},loadResource:function(){var self=this;if(self.get("resourceId")){var resource=new Backbone.Model({id:self.get("resourceId")});resource.url="/__resources/"+resource.id,resource.fetch({success:function(){self.set({resourceName:resource.get("path"),resourceType:resource.get("typeLabel"),resourceTypeId:resource.get("type")});if(resource.get("type")==="UserCollection"||resource.get("type")==="Collection"){var newResource=new CollectionSettings;newResource.set(newResource.parse(resource.attributes)),resource=newResource}self.set({resource:resource})}})}else self.set({resource:null,resourceName:undefined,resourceType:undefined,resourceTypeId:undefined})},setDocLink:function(){var type=this.get("resourceTypeId"),url="http://deployd.github.com/deployd/";type==="Static"?url+="#Files-Resource":type==="Collection"?url+="#Collection-Resource":type==="UserCollection"&&(url+="#User-Collection-Resource"),this.set("documentation",url)}});module.exports=new App}),define("view/save-status-view",["require","exports","module"],function(require,exports,module){function init(preventReset){$span=$("#save-status"),preventReset?($span.text(currentText),setActive(active)):(set(""),setActive(!1))}function saving(){set("Saving..."),setActive(!0)}function saved(){var now=new Date;set("Last saved "+now.toLocaleTimeString()),setActive(!1)}function set(text){currentText=text,$span.text(text)}function error(){set("Error"),setActive(!1)}function setActive(nowActive){nowActive?$span.removeClass("inactive"):$span.addClass("inactive"),active=nowActive}var $span,currentText="",active=!1;module.exports={init:init,saving:saving,saved:saved,error:error},init()}),define("backbone-utils",["require","exports","module","./app","./view/save-status-view"],function(require,exports,module){function isArray(o){return Object.prototype.toString.call(o)==="[object Array]"}var app=require("./app"),saveStatus=require("./view/save-status-view");Backbone.View.prototype.close=function(){this.remove(),this.unbind()};var oldSync=Backbone.sync;Backbone.sync=function(method,model,options){var url=_.isFunction(model.url)?model.url():model.url;url=app.get("appUrl")+url;if(method==="create"||method==="update"||method==="delete"){saveStatus.saving();var lastSuccess=options.success,lastError=options.error,success=function(){saveStatus.saved(),lastSuccess&&lastSuccess.apply(this,arguments)},error=function(){saveStatus.error(),lastError&&lastError.apply(this,arguments)};options.success=success,options.error=error}if(method==="create"||method==="update"){var data=options.data||model.toJSON();typeof data!="string"&&(Backbone.Utils.removeClientValues(data),options.contentType="application/json",options.data=JSON.stringify(data))}return options.headers={"dpd-ssh-key":!0},options.url=options.url||url,oldSync(method,model,options)};var oldCheckUrl=Backbone.History.prototype.checkUrl;Backbone.History.prototype.checkUrl=function(e){this._lastFragment=this.fragment;if(this.getFragment()!==this.fragment){var loadEvent={cancel:!1};this.trigger("load",loadEvent);if(loadEvent.cancel)return this.navigate(this.fragment,{trigger:!0,replace:!0}),e.preventDefault(),window.location.hash=this.fragment,!1}oldCheckUrl.apply(this,arguments)},Backbone.Utils=Backbone.Utils||{},Backbone.Utils.removeClientValues=function(json){return isArray(json)?_.each(json,function(val,index){typeof val=="object"&&Backbone.Utils.removeClientValues(val)}):_.each(json,function(val,key){_.str.startsWith(key,"c_")?delete json[key]:typeof val=="object"&&Backbone.Utils.removeClientValues(val)}),json},Backbone.Utils.parseDictionary=function(resp,options){var defaults={keyProperty:"label"};options=_.defaults(options||{},defaults);var keys=Object.keys(resp),result=[];return _.each(keys,function(key){var model=resp[key];model.id=key,model[options.keyProperty]=model[options.keyProperty]||key,result.push(model)}),result},Backbone.Utils.toJSONDictionary=function(json,options){var defaults={keyProperty:"label"};_.defaults(options,defaults);var result={};return _.each(json,function(model){var key=model[options.keyProperty];delete model[options.keyProperty],result[key]=model}),result},Backbone.Utils.cancelEvent=function(e){return!1}}),define("knockout-utils",["require","exports","module"],function(require,exports,module){function objectEquals(x,y){var p;for(p in y)if(typeof x[p]=="undefined")return!1;for(p in y)if(y[p])switch(typeof y[p]){case"object":if(!objectEquals(x[p],y[p]))return!1;break;case"function":if(typeof x[p]=="undefined"||p!="equals"&&y[p].toString()!=x[p].toString())return!1;break;default:if(y[p]!=x[p])return!1}else if(x[p])return!1;for(p in x)if(typeof y[p]=="undefined")return!1;return!0}var unwrap=ko.utils.unwrapObservable;ko.bindingHandlers.cssNamed={update:function(element,valueAccessor){var value=ko.utils.unwrapObservable(valueAccessor()),lastClass=$(element).data("knockoutCssNamed");$(element).removeClass(lastClass||" ").addClass(value).data("knockoutCssNamed",value)}},ko.bindingHandlers.enter={init:function(element,valueAccessor,allBindings,viewModel){var handler=ko.utils.unwrapObservable(valueAccessor());$(element).keypress(function(e){e.which===13&&handler.call(viewModel,viewModel,e)})}},ko.bindingHandlers.escape={init:function(element,valueAccessor,allBindings,viewModel){var handler=ko.utils.unwrapObservable(valueAccessor());$(element).keypress(function(e){e.which===23&&handler.call(viewModel,viewModel,e)})}},ko.bindingHandlers.tooltip={init:function(element,valueAccessor){var value=ko.toJS(valueAccessor());typeof value=="string"&&(value={title:value}),$(element).tooltip(value)},update:function(element,valueAccessor){var value=valueAccessor(),title;typeof value=="string"?title=value:title=unwrap(value.title),$(element).attr("data-original-title",title).tooltip("fixTitle")}},ko.bindingHandlers.popover={init:function(element,valueAccessor){var value=ko.toJS(valueAccessor());$(element).popover(value)},update:function(element,valueAccessor){$(element).attr("data-original-title",unwrap(valueAccessor().title)),$(element).attr("data-content",unwrap(valueAccessor().content))}},ko.extenders.variableName=function(target){var result=ko.computed({read:target,write:function(newValue){var current=target();newValue=newValue.replace(/[^A-Za-z0-9]/g,""),current!==newValue&&target(newValue)}});return result(target()),result},module.exports={objectEquals:objectEquals}}),define("view/undo-button-view",["require","exports","module"],function(require,exports,module){function init(){$button=$("#undo-btn"),$actionLabel=$(".action-label",$button),hide(),$button.click(function(){reverseFunc(),$button.hide()})}function show(label,reverse){$button.show(),$actionLabel.text(label),reverseFunc=reverse}function hide(){$button.hide(),reverseFunc=null,$actionLabel.text("")}var $button,$actionLabel,reverseFunc;module.exports={init:init,show:show,hide:hide},init()}),define("view/divider-drag",["require","exports","module"],function(require,exports,module){module.exports=function(){function setDividerPoint(y){y>totalHeight-MIN_AREA?y=totalHeight-MIN_AREA:y<MIN_AREA&&(y=MIN_AREA),dividerPoint=y,$top.outerHeight(y-dividerHeight/2),$bottom.outerHeight(totalHeight-y-dividerHeight),$divider.css("top",y),$(".main-area .panel").height($top.innerHeight()-44)}var DIVIDER_PADDING=10,MIN_AREA=50,$area=$(".main-area"),$top=$(".top-panel",$area),$bottom=$(".bottom-panel",$area),$divider=$(".divider",$area),dividerHeight=$divider.outerHeight(),totalHeight=$area.innerHeight(),dividerPoint=0;setDividerPoint(totalHeight-totalHeight/3),$divider.mousedown(function(){var drag=function(e){var y=e.pageY-$area.offset().top;return setDividerPoint(y),!1};return $(window).mousemove(drag),$(window).mouseup(function(){return $(window).unbind("mousemove",drag),!1}),!1}),$(window).resize(function(){var percent=dividerPoint/totalHeight;totalHeight=$area.innerHeight(),setDividerPoint(totalHeight*percent)})}}),define("router",["require","exports","module","./app"],function(require,exports,module){var app=require("./app"),Router=Backbone.Router.extend({routes:{"":"home",files:"files","files/*path":"editFile",":id":"resource"},home:function(){app.set({resourceId:undefined,files:undefined})},resource:function(id){app.set({resourceId:id,files:undefined})},files:function(){app.set({resourceId:undefined,files:!0})},editFile:function(path){app.set({resourceId:undefined,files:path})}});module.exports=new Router}),define("model/resource",["require","exports","module"],function(require,exports,module){var Resource=module.exports=Backbone.Model.extend({defaults:{path:"",order:0},parse:function(json){return json.$renameFrom=json.path,json},initialize:function(){this.on("change:path",this.sanitizePath,this)},sanitizePath:function(){var path=this.get("path");path=Resource.sanitizePath(path),path!==this.get("path")&&this.set({path:path})}});Resource.sanitizePath=function(path){return path=path.toLowerCase().replace(/[ _]/g,"-").replace(/[^a-z0-9\/\-]/g,""),_.str.startsWith(path,"/")||(path="/"+path),path}}),define("model/resource-collection",["require","exports","module","../model/resource","../app"],function(require,exports,module){var Resource=require("../model/resource"),app=require("../app"),ResourceCollection=module.exports=Backbone.Collection.extend({model:Resource,url:"/__resources",initialize:function(){this.on("error",this.error,this)},comparator:function(resource){return resource.get("order")},error:function(){app.set({authKey:undefined},{silent:!0}),app.trigger("change:authKey")},fetch:function(options){options=_.extend(options||{},{data:{q:'{"type": {"$ne": "Static"}}'}}),Backbone.Collection.prototype.fetch.call(this,options)}})}),define("view/template-view",["require","exports","module"],function(require,exports,module){var TemplateView=module.exports=Backbone.View.extend({initialize:function(){this.template=_.template($("#"+this.template).html()),this.render(),this.model&&this.model.on("change",this.render,this),this.collection&&(this.collection.on("reset",this.render,this),this.collection.on("add",this.render,this),this.collection.on("remove",this.render,this))},templateData:function(){return{model:this.model,collection:this.collection}},render:function(){$(this.el).html(this.template(this.templateData()))}})}),define("view/auth-modal-view",["require","exports","module","../app","./template-view"],function(require,exports,module){var app=require("../app"),TemplateView=require("./template-view"),AuthModalView=module.exports=TemplateView.extend({el:"#authModal",template:"auth-modal-template",initialize:function(){_.bindAll(this),TemplateView.prototype.initialize.apply(this,arguments),this.$el=$(this.el).modal({show:!1}),this.$el.on("click",".save",this.saveAuthToken),this.$el.on("hidden",this.cancel)},saveAuthToken:function(){return this.hide(),setTimeout(_.bind(function(){var authKey=this.$el.find("[name=key]").val();app.set({authKey:authKey},{silent:!0}),app.trigger("change:authKey")},this),0),!1},show:function(){this.$el.find("[name=key]").val(app.get("authKey")),this.$el.modal("show")},hide:function(){this._programHide=!0,setTimeout(_.bind(function(){this._programHide=!1},this),0),this.$el.modal("hide")},update:function(){app.get("authKey")?this.hide():this.show()},showError:function(){this.$el.find(".key-error").show()},hideError:function(){this.$el.find(".key-error").hide()},cancel:function(){this._programHide||setTimeout(this.show,0)}})}),define("view/resource-sidebar-view",["require","exports","module","./template-view","../app"],function(require,exports,module){var TemplateView=require("./template-view"),app=require("../app"),ResourceSidebarView=module.exports=TemplateView.extend({el:"#resource-sidebar",template:"resource-sidebar-template",initialize:function(){app.on("change:resourceId",this.render,this),app.on("change:files",this.render,this),TemplateView.prototype.initialize.apply(this,arguments)},templateData:function(){return _.extend(TemplateView.prototype.templateData.apply(this),{app:app.toJSON()})}})}),define("view/component-type-sidebar-view",["require","exports","module"],function(require,exports,module){var ComponentTypeSidebarView=module.exports=Backbone.View.extend({events:{"click li":"onAddItem"},initialize:function(){this.collection=this.collection||this.options.collection,this.template=this.template||this.options.template,this.listView=this.listView||this.options.listView,this.collection.on("reset",this.render,this)},render:function(){var self=this;$(this.el).html(this.template({types:this.collection})),self.$("li").each(function(){}).popover({placement:"right"})},onAddItem:function(e){var typeCid=$(e.currentTarget).attr("data-cid"),type=this.collection.getByCid(typeCid);this.listView.addItem(type)}})}),define("view/resource-view",["require","exports","module","./undo-button-view","../router"],function(require,exports,module){var undo=require("./undo-button-view"),router=require("../router"),template=_.template($("#resource-template").html()),ResourceView=module.exports=Backbone.View.extend({tagName:"li",className:"component-item",events:{"click .delete-btn":"delete","click .component-item-header":"onClickHeader","click .path":"activate","click .rename-btn":"activate","click .cancel-btn":"deactivate","click .save-btn":"save",'keypress input[name="path"]':"onKeypress",'keyup input[name="path"]':"onKeyup"},initialize:function(){this.parentView=this.options.parentView,this.model.on("change:c_active",this.render,this),this.model.on("change:id",this.render,this),this.model.on("change:path",this.render,this)},render:function(){var $el=$(this.el);return $el.attr("id",this.model.cid).html(template({resource:this.model.toJSON()})),this.model.isNew()?$el.addClass("unsaved"):$el.removeClass("unsaved"),this},gotoDetail:function(){return this.model.isNew()||router.navigate(this.model.get("id"),{trigger:!0}),!1},"delete":function(){var self=this;return self.model.isNew()?self.model.destroy():confirm("Do you wish to delete this resource? All associated data and configuration will be permanently removed.")&&self.model.destroy({wait:!0}),!1},activate:function(){return this.model.set({c_active:!0}),this.$('input[name="path"]').focus(),!1},deactivate:function(){return this.model.isNew()?this.delete():this.model.set({c_active:!1}),!1},save:function(){return this.model.save({path:this.$('input[name="path"]').val()}),this.model.set({c_active:!1}),!1},onClickHeader:function(e){if($(e.target).hasClass("component-item-header")||$(e.target).hasClass("type-icon"))return this.model.get("c_active")?this.deactivate():this.gotoDetail(),!1;this.onFocus(e)},onFocus:function(e){$(e.target).focus()},onKeypress:function(e){var val=$(e.currentTarget).val();_.str.startsWith(val,"/")||(val="/"+val,$(e.currentTarget).val(val))},onKeyup:function(e){e.which==13&&(this.model.isNew()?this.model.save({path:this.$('input[name="path"]').val()},{success:_.bind(function(){this.gotoDetail()},this)}):this.save()),e.which==27&&this.deactivate()},destroy:function(){this.model.off("change:c_active",this.render),this.model.off("change:id",this.render),this.model.off("change:path",this.render)}})}),define("view/resource-list-view",["require","exports","module","../model/resource","./resource-view"],function(require,exports,module){var Resource=require("../model/resource"),ResourceView=require("./resource-view"),ResourceListView=module.exports=Backbone.View.extend({el:"#resource-list",emptyEl:"#resource-list-empty",subViews:[],initialize:function(){this.parentView=this.options.parentView,this.collection=this.options.collection,this.typeCollection=this.options.typeCollection,this.collection.on("reset",this.render,this),this.collection.on("add",this.render,this),this.collection.on("remove",this.render,this),this.initializeDom(),this.render()},initializeDom:function(){},addItem:function(type,index){isNaN(index)&&(index=this.collection.length);var resource=new Resource({path:type.get("defaultPath"),typeLabel:type.get("label"),type:type.get("id"),order:index+1,c_active:!0});return this.collection.add(resource,{at:index}),this.updateOrder(),setTimeout(function(){this.$("#"+resource.cid).find('input[name="path"]').focus()},0),!1},updateOrder:function(){var self=this,items=[];$(this.el).children().each(function(){var item=self.collection.getByCid($(this).attr("id"));item&&items.push(item)});var order=0;_.each(items,function(item){order+=1,item.isNew()?item.set({order:order},{silent:!0}):item.save({order:order},{silent:!0})})},onReceiveComponent:function($newItem,index){var typeCid=$newItem.attr("data-cid"),type=this.parentView.resourceTypes.getByCid(typeCid);$newItem.remove(),this.addItem(type,index)},onReorder:function(){this.updateOrder()},render:function(e){var self=this;_.each(self.subViews,function(subView){subView.destroy()}),$(self.el).find("li:not(.locked)").remove(),self.collection.length?($(self.emptyEl).hide(),self.subViews=self.collection.map(function(resource){var view=new ResourceView({model:resource,parentView:self});return $(self.el).append(view.el),view.render(),view})):$(self.emptyEl).show()}})}),define("model/resource-type-collection",["require","exports","module","../backbone-utils"],function(require,exports,module){require("../backbone-utils");var ResourceTypeCollection=module.exports=Backbone.Collection.extend({url:"/__resources/types",sort:function(model){return model.get("label")},parse:function(json){return Object.keys(json).forEach(function(key){key==="Collection"?(json[key].tooltip="Add a simple store to save, update, fetch and delete JSON objects. Available over REST at the specified url.",json[key].tooltipTitle="Persist Data"):key==="UserCollection"?(json[key].tooltip="Add a collection of users such as 'admins', 'authors', or just 'users'. Store users as JSON objects and log them in over REST.",json[key].tooltipTitle="Manage Users"):key==="Static"&&delete json[key]}),Backbone.Utils.parseDictionary(json)}})}),define("view/resources-view",["require","exports","module","./component-type-sidebar-view","./resource-list-view","./template-view","../model/resource-collection","../model/resource-type-collection","router"],function(require,exports,module){var ComponentTypeSidebarView=require("./component-type-sidebar-view"),ResourceListView=require("./resource-list-view"),TemplateView=require("./template-view"),ResourceCollection=require("../model/resource-collection"),ResourceTypeCollection=require("../model/resource-type-collection"),router=require("router"),ResourcesView=module.exports=TemplateView.extend({el:"#resources-container",template:"resources-template",typesTemplate:_.template($("#resource-types-template").html()),events:{"click #property-types a":"addItem","click #files-resource":"goToFiles"},initialize:function(){this.resources=this.options.resources,this.resourceTypes=new ResourceTypeCollection,TemplateView.prototype.initialize.apply(this,arguments),this.resourceListView=new ResourceListView({collection:this.resources,typeCollection:this.resourceTypes,parentView:this}),this.resourceTypes.on("reset",this.renderTypes,this),this.resourceTypes.fetch()},goToFiles:function(){router.navigate("files",{trigger:!0})},addItem:function(e){var typeCid=$(e.currentTarget).parents("li").attr("data-cid"),type=this.resourceTypes.getByCid(typeCid);this.resourceListView.addItem(type)},renderTypes:function(){$("#property-types").html(this.typesTemplate({types:this.resourceTypes})).find("li").popover({placement:"left"})}})}),define("view/header-view",["require","exports","module","../model/resource","./save-status-view","./undo-button-view"],function(require,exports,module){var Resource=require("../model/resource"),saveStatus=require("./save-status-view"),undoBtn=require("./undo-button-view"),HeaderView=module.exports=Backbone.View.extend({el:"#header",template:_.template($("#header-template").html()),events:{"click .resourceName":"rename"},initialize:function(){this.model.on("change",this.render,this),this.render()},rename:function(){var resource=this.model.get("resource"),newName=prompt("Enter a new name for this "+resource.get("type"),resource.get("path"));return newName&&(newName=Resource.sanitizePath(newName),resource.save({path:newName,$renameFrom:resource.get("path")}),this.model.set("resourceName",newName)),!1},render:function(){return $(this.el).html(this.template(this.model.toJSON())),saveStatus.init(!0),undoBtn.init(),this}})}),define("model/property-type-collection",["require","exports","module","../backbone-utils"],function(require,exports,module){require("../backbone-utils");var PropertyTypeCollection=module.exports=Backbone.Collection.extend({url:"/property-types",initialize:function(){this.reset([{id:"string",label:"string",tooltip:"Add a string property. If the incoming value is not a string it will be rejected.",tooltipTitle:"Arbitrary Text"},{id:"number",label:"number",tooltip:"Add a number property. If the incoming value is not a number it will be rejected. Supports floating point values.",tooltipTitle:"JSON Number"},{id:"boolean",label:"boolean",tooltip:"Add a boolean property. If the incoming value is not 'true' or 'false' it will be rejected.",tooltipTitle:"True or false"},{id:"date",label:"date",tooltip:"Add a date string property. If the incoming value is not a valid date string it will be rejected.",tooltipTitle:"A specific point in time"},{id:"object",label:"object",tooltip:"Add an object property. If the incoming value is not an object it will be rejected.",tooltipTitle:"JSON Object"},{id:"array",label:"array",tooltip:"Add an array property. If the incoming value is not an array it will be rejected.",tooltipTitle:"JSON Array"}])},fetch:function(){var self=this;setTimeout(function(){self.trigger("reset")},0)},sort:function(model){return model.get("label")}})}),define("model/data-collection",["require","exports","module"],function(require,exports,module){var DataCollection=module.exports=Backbone.Collection.extend({url:function(){var url=this.path;return this.querystring&&(this.querystring.indexOf("{")==0?url+="?q="+this.querystring:url+="?"+this.querystring),url}})}),define("view-model/property-view-model",["require","exports","module"],function(require,exports){function create(data,contextToAdd){function execCommand(data,e){return e.metaKey||e.which===38||e.which===40?(commands[e.which]&&commands[e.which](data),!1):!0}data=_.defaults(data||{},{name:" ",type:"string",typeLabel:"string",required:!1}),data.id=data.name;var self=ko.mapping.fromJS(data,propertyMapping);self.name=self.name.extend({variableName:!0}),self.editing=ko.observable(!1),self.nameFocus=ko.observable(),self.isNew=contextToAdd!=null,self.toggleEditing=function(){return self.editing(!self.editing()),self.editing()&&self.nameFocus(!0),!1},self.onClickHeader=function(data,e){return!self.editing()||e.target===e.currentTarget||$(e.target).is("div")?(self.toggleEditing(),!1):!0},self.onNameKeypress=function(data,e){return e.which==13&&setTimeout(function(){self.isNew?contextToAdd.addProperty():self.editing(!1)},1),!0},self.onNameKeyDown=function(data,e){return commands[e.which]?execCommand(data,e):!0},self.setType=function(data){self.type(ko.utils.unwrapObservable(data.id)),self.typeLabel(ko.utils.unwrapObservable(data.label))};var types=["string","number","boolean","date","object","array"],commands={66:function(data){data.type("boolean")},83:function(data){data.type("string")},77:function(data){data.type("number")},68:function(data){data.type("date")},38:function(data){var cur=data.type();for(var i=0;i<types.length;i++)if(cur===types[i]){data.type(types[i+1]||types[0]);return}},40:function(data){var cur=data.type();for(var i=0;i<types.length;i++)if(cur===types[i]){data.type(types[i-1]||types[types.length-1]);return}},79:function(data){data.required(!data.required())}};return self}var propertyMapping={include:["required","id","$renameFrom"]};exports.create=create}),define("view-model/property-list-view-model",["require","exports","module","../view/undo-button-view","./property-view-model"],function(require,exports){function create(){var vm={properties:ko.observableArray(),propertyTypes:ko.observableArray()};return vm.newProperty=propertyViewModel.create({},vm),vm.newProperty.nameFocus(!0),vm.addProperty=_.bind(function(){this.newProperty.name()&&this.newProperty.type()&&(this.properties.push(propertyViewModel.create(ko.mapping.toJS(this.newProperty))),this.newProperty.name(""))},vm),vm.removeProperty=_.bind(function(prop){var self=this,index=this.properties.indexOf(prop);undoBtn.show("Delete "+prop.name(),function(){self.properties.splice(index,0,prop)}),this.properties.remove(prop)},vm),vm.onNewNameKeypress=_.bind(function(context,e){return e.which==13&&setTimeout(function(){vm.addProperty()},1),!0},vm),vm}var undoBtn=require("../view/undo-button-view"),propertyViewModel=require("./property-view-model");exports.create=create}),define("view/property-list-view",["require","exports","module","../knockout-utils","../app","./undo-button-view","../view-model/property-list-view-model","../view-model/property-view-model"],function(require,exports,module){var koUtil=require("../knockout-utils"),app=require("../app"),undoBtn=require("./undo-button-view"),propertyListViewModel=require("../view-model/property-list-view-model"),propertyViewModel=require("../view-model/property-view-model"),PropertyListView=module.exports=Backbone.View.extend({el:"#property-list",template:_.template($("#property-list-template").html()),initialize:function(){this.collection=this.collection||this.options.collection,this.typeCollection=this.typeCollection||this.options.typeCollection,this.initializeViewModel(),this.mapProperties(),this.collection.on("reset",this.mapProperties,this),this.mapTypes(),this.typeCollection.on("reset",this.mapTypes,this),this.render()},initializeViewModel:function(){var view=this;this.viewModel=propertyListViewModel.create(),this.mapping={properties:{key:function(data){return ko.utils.unwrapObservable(data.name)},create:_.bind(function(options){return propertyViewModel.create(options.data)},this)}},ko.computed(function(){var lastJSON=view._lastJSON,unmapped=ko.mapping.toJS(this),newJSON=unmapped.properties;lastJSON&&!koUtil.objectEquals(lastJSON,newJSON)&&(view.collection.reset(unmapped.properties,{silent:!0}),view.collection.trigger("update"),view._lastJSON=newJSON)},this.viewModel).extend({throttle:100})},mapProperties:function(){var json=this.collection.toJSON();this._lastJSON=json,ko.mapping.fromJS({properties:json},this.mapping,this.viewModel);var newJson=ko.mapping.toJS(this.viewModel);koUtil.objectEquals(newJson.properties,json)||(console.log("WARNING: viewmodel/model mismatched. Remapping..."),this.viewModel.properties.removeAll(),setTimeout(_.bind(this.mapProperties,this),1))},mapTypes:function(){ko.mapping.fromJS({propertyTypes:this.typeCollection.toJSON()},this.mapping,this.viewModel)},render:function(){this.el&&ko.cleanNode(this.el),$(this.el).html(this.template({resourceTypeId:app.get("resourceTypeId")})),ko.applyBindings(this.viewModel,this.el)},close:function(){ko.removeNode(this.el)}})}),define("view/property-reference-view",["require","exports","module"],function(require,exports,module){var PropertyReferenceView=module.exports=Backbone.View.extend({el:"#property-reference",template:_.template($("#property-reference-template").html()),initialize:function(){this.render(),this.model.on("change",this.render,this)},render:function(){$(this.el).html(this.template({model:this.model})),this.$("li i").tooltip({placement:"left"})}})}),define("view-model/collection-data-view-model",["require","exports","module"],function(require,exports,module){createRow=exports.createRow=function(data,props,vm){function map(data,props){var defaults={id:null};props.forEach(function(prop){defaults[prop.name]=undefined}),data=_.defaults(data,defaults),ko.mapping.fromJS(data,{},self)}var self={};return map(data,props),self.c_editing=ko.observable(!1),self.c_focus=ko.observable(),self.c_errors=ko.observable({}),self.c_formatted=function(name,type){var name=ko.utils.unwrapObservable(name),type=ko.utils.unwrapObservable(type),value=ko.utils.unwrapObservable(self[name]);return type==="password"||typeof value=="undefined"?"...":value},self.c_toggleEditing=function(){self.c_editing()&&!self.isNew?vm.revertRow(self):self.c_editing(!0)},self.c_remapProps=function(props){var data=ko.mapping.toJS(self);map(data,props)},self._onKeypress=function(data,e){return e.which==13?setTimeout(function(){vm.saveRow(self)},1):e.which==27&&!self.isNew&&setTimeout(function(){vm.revertRow(self)},1),!0},self._onDoubleclick=function(data,e){if(!!self.c_editing())return!0;self.c_editing(!0),self.c_focus(data.name())},self},create=exports.create=function(){var self={properties:ko.observableArray(),collection:ko.observableArray(),queryString:ko.observable(),queryError:ko.observable("")};return self.newRow=createRow({},[],self),self.newRow.isNew=!0,self}}),define("view/collection-data-view",["require","exports","module","../view-model/collection-data-view-model","../app","./undo-button-view"],function(require,exports,module){var collectionDataViewModel=require("../view-model/collection-data-view-model"),app=require("../app"),undoBtn=require("./undo-button-view"),CollectionDataView=module.exports=Backbone.View.extend({el:"#data",template:_.template($("#collection-data-template").html()),initialize:function(){var self=this;self.properties=self.options.properties,self.collection=self.options.collection,self.initializeViewModel(),self.initializeMapping(),self.isUser=app.get("resourceTypeId")==="UserCollection",self.mapProperties(),self.properties.on("reset",self.mapProperties,self),self.properties.on("add",self.mapProperties,self),self.properties.on("remove",self.mapProperties,self),self.properties.on("change:name",self.mapProperties,self),self.mapCollection(),self.collection.on("reset",self.mapCollection,self),self.collection.on("add",self.mapCollection,self),self.collection.on("remove",self.mapCollection,self),function e(model,xhr){if(self._cleared)return;xhr&&xhr.responseText?self.viewModel.queryError(xhr.responseText):self.viewModel.queryError(""),self._timeout=setTimeout(function(){self.collection.fetch({success:poll,error:poll})},1e3)}(),self.render()},initializeViewModel:function(){var view=this,vm=view.viewModel=collectionDataViewModel.create();vm.deleteRow=function(data){var collection=view.collection,row=collection.get(data.id()),index=collection.indexOf(row);row&&row.destroy({wait:!0}),row.set("id",undefined),undoBtn.show("Delete row",function(){collection.create(row,{at:index})})},vm.saveRow=function(data){function error(model,xhr){try{var res=JSON.parse(xhr.responseText);data.c_errors(res.errors)}catch(e){alert("An error occurred when saving: "+xhr.responseText)}}var rowData=ko.mapping.toJS(data),collection=view.collection;if(data.isNew)collection.create(rowData,{success:function(){data.c_errors({}),vm.properties().forEach(function(prop){data[prop.name()]&&data[prop.name()](null)})},error:error,wait:!0});else{var row=collection.get(data.id());row.save(rowData,{success:function(){data.c_editing(!1),data.c_errors({}),ko.mapping.fromJS(row.toJSON(),{},data)},error:error})}},vm.revertRow=function(data){var collection=view.collection,row=collection.get(data.id());row.fetch({success:function(){ko.mapping.fromJS(row.toJSON(),{},data),data.c_editing(!1)}})},ko.computed(function(){view.collection.querystring=vm.queryString()},vm).extend({throttle:100}),ko.computed(function(){var error=vm.queryError(),$field=view.$("#current-data-querystring");error?$field.attr("data-original-title",error).tooltip("fixTitle").tooltip("show"):$field.attr("data-original-title","").tooltip("fixTitle").tooltip("hide")},vm)},initializeMapping:function(){var view=this,vm=this.viewModel;view.propertiesMapping={properties:{key:function(data){return ko.utils.unwrapObservable(data.id)}}},view.collectionMapping={collection:{key:function(data){return ko.utils.unwrapObservable(data.id)},create:function(options){return collectionDataViewModel.createRow(options.data,ko.mapping.toJS(vm.properties),vm)},update:function(options){return options.target.c_editing()?options.data:options.target}}}},mapProperties:function(){var props=this.properties.toJSON();app.get("resourceTypeId")==="UserCollection"&&props.unshift({name:"email",type:"string",typeLabel:"string"},{name:"password",type:"password",typeLabel:"password"}),this.viewModel.collection().forEach(function(row){row.c_remapProps(props)}),this.viewModel.newRow.c_remapProps(props),ko.mapping.fromJS({properties:props},this.propertiesMapping,this.viewModel)},mapCollection:function(){ko.mapping.fromJS({collection:this.collection.toJSON()},this.collectionMapping,this.viewModel)},render:function(){var self=this;ko.cleanNode(this.el),$(this.el).html(this.template({resourceType:app.get("resourceTypeId")})),ko.applyBindings(this.viewModel,this.el)},close:function(){this._cleared=!0,clearTimeout(this._timeout),ko.removeNode(this.el)}})}),define("view/code-editor-view",["require","exports","module"],function(require,exports,module){function getEditor(el){return _editor||(_editor=ace.edit($editorEl[0]),_editor.setTheme("ace/theme/deployd"),_editor.setShowPrintMargin(!1)),$(el).append($editorEl),_editor}var JavaScriptMode=ace.require("ace/mode/javascript").Mode,CssMode=ace.require("ace/mode/css").Mode,HtmlMode=ace.require("ace/mode/html").Mode,$editorEl=$("<div>"),_editor,CodeEditorView=module.exports=Backbone.View.extend(Backbone.Events).extend({initialize:function(){this.mode=this.options.mode,_.bindAll(this,"trackUpdate","update","render")},trackUpdate:function(){this._timeout&&clearTimeout(this._timeout);var length=this.updateTime||1e3;this._timeout=setTimeout(this.update,length)},update:function(){this.trigger("change")},getText:function(){return this.editor?this.editor.getSession().getValue():undefined},setText:function(val){this.editor.getSession().setValue(val),clearTimeout(this._timeout)},resize:function(){this.editor.resize()},render:function(){var view=this,editor=getEditor(this.el);editor.resize();var mode=this.mode||"js";return mode==="html"||mode==="htm"?editor.getSession().setMode(new HtmlMode):mode==="css"?editor.getSession().setMode(new CssMode):mode==="js"&&editor.getSession().setMode(new JavaScriptMode),editor.getSession().on("change",this.trackUpdate),editor.commands.addCommand({name:"save",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(editor){view.trigger("save")}}),this.editor=editor,editor.focus(),this},close:function(){this._timeout&&clearTimeout(this._timeout),this.off(),this.setText("")}})}),define("view/collection-event-view",["require","exports","module","./code-editor-view"],function(require,exports,module){var CodeEditorView=require("./code-editor-view"),CollectionEventView=module.exports=Backbone.View.extend({template:_.template($("#events-template").html()),events:{"click #event-nav a":"updateRender"},initialize:function(){var self=this;$(this.el).html(this.template(this.model.toJSON())),this.editor=(new CodeEditorView({})).render(),this.editor.on("change",self.update,self),this.resize=_.bind(this.resize,this),$("#resource-sidebar").on("click","a",this.resize)},getActive:function(){return this.$("#event-nav .active a").attr("data-editor")},update:function(e){var text=this.editor.getText();typeof text!="undefined"&&this.model.set(this.getActive(),text)},updateRender:function(){this.update(),setTimeout(_.bind(this.render,this),1)},render:function(){var active=this.getActive();return this.editor.setText(this.model.get(active)),this.editor.setElement("#"+active),this.editor.render(),this},resize:function(){setTimeout(_.bind(this.editor.resize,this),1)},close:function(){$("#resource-sidebar").off("click","a",this.resize),this.editor.close()}})}),define("view/collection-routes-view",["require","exports","module"],function(require,exports,module){var CollectionRoutesView=module.exports=Backbone.View.extend({el:"#api",template:_.template($("#collection-routes-template").html(),null,{variable:"resourceData"}),initialize:function(){this.render(),this.model.on("change",this.render,this)},render:function(){$(this.el).html(this.template(this.model.toJSON())),prettyPrint()}})}),define("view/collection-view",["require","exports","module","../model/property-type-collection","../model/collection-settings","../model/data-collection","./property-list-view","./property-reference-view","./collection-data-view","./collection-event-view","./collection-routes-view","../app","../router","./undo-button-view"],function(require,exports,module){var PropertyTypeCollection=require("../model/property-type-collection"),CollectionSettings=require("../model/collection-settings"),DataCollection=require("../model/data-collection"),PropertyListView=require("./property-list-view"),PropertyReferenceView=require("./property-reference-view"),CollectionDataView=require("./collection-data-view"),CollectionEventView=require("./collection-event-view"),CollectionRoutesView=require("./collection-routes-view"),app=require("../app"),router=require("../router"),undoBtn=require("./undo-button-view"),CollectionView=module.exports=Backbone.View.extend({template:_.template($("#collection-template").html()),events:{"click .cta-link":"onClickCta"},initialize:function(){$(this.el).html(this.template({})),this.propertyTypes=new PropertyTypeCollection,this.dataCollection=new DataCollection([]),this.dataCollection.path=this.model.get("path"),this.dataCollection.fetch(),this.model.on("change:path",function(){this.dataCollection.path=this.model.get("path")},this),this.propertyListView=new PropertyListView({collection:this.model.get("properties"),typeCollection:this.propertyTypes,parentView:this}),this.PropertyReferenceView=new PropertyReferenceView({model:this.model}),this.dataView=new CollectionDataView({properties:this.model.get("properties"),collection:this.dataCollection}),this.routesView=new CollectionRoutesView({model:this.model}),this.eventsView=(new CollectionEventView({el:this.$("#events-panel"),model:this.model})).render(),this.model.on("change",this.save,this),this.dataCollection.on("reset",this.render,this),this.model.on("change",this.render,this),this.propertyTypes.fetch(),this.render(),this.initializeDom()},initializeDom:function(){this.onKeypress=_.bind(this.onKeypress,this),$(".icon-info-sign").popover(),this.model.get("properties").length?this.$('#resource-sidebar a[href="#data"]').click():this.$('#resource-sidebar a[href="#properties"]').click()},save:function(){var self=this;this.model.save()},onKeypress:function(e){if((e.ctrlKey||e.metaKey)&&e.which=="83")return this.save(),e.preventDefault(),!1},onClickCta:function(e){var href=$(e.currentTarget).attr("href"),$navLink=$('#resource-sidebar a[href="'+href+'"]');return $navLink.click(),!1},navigate:function(e){var $link=$(e.currentTarget),selector=$link.attr("href");return $(window).scrollTop($(selector).offset().top-50),!1},render:function(){var $nowWhat=$("#property-now-what");return this.model.get("properties").length&&!this.dataCollection.length?$nowWhat.show():$nowWhat.hide(),this},close:function(){Backbone.View.prototype.close.call(this),this.propertyListView.close(),this.dataView.close(),this.eventsView.close(),$(window).off("scroll",this.onScroll)}})}),define("model/file",["require","exports","module","../app"],function(require,exports,module){var app=require("../app"),File=module.exports=Backbone.Model.extend({url:function(){var info=this.get("info"),path=this.get("path");return info?(path==="/"&&(path=""),path+"/"+(info.name||info.fileName)):path},sync:function(method,model,options){function next(){}var self=this,args=arguments,info=model.get("info"),data=model.get("data");if(method==="create"&&(info||data)){var form;if(info)form=new FormData,form.append("data",info);else if(data||data==="")form=data;var url=_.isFunction(model.url)?model.url():model.url;url=app.get("appUrl")+url;var xhr=new XMLHttpRequest;xhr.open("POST",url),xhr.setRequestHeader("x-dssh-key",app.get("authKey")),xhr.send(form),xhr.addEventListener("readystatechange",function(){typeof options.success=="function"&&options.success(),self.trigger("sync")})}else Backbone.sync.apply(model,args)}})}),define("view-model/folder-view-model",["require","exports","module","model/file","model/resource","app"],function(require,exports,module){function parseModel(json){return{data:json}}function fetchFolders(options){return options=_.extend(options||{},{data:{type:"Static"}}),Backbone.Collection.prototype.fetch.call(this,options)}var File=require("model/file"),Resource=require("model/resource"),app=require("app"),foldersMapping={folders:{key:function(data){return ko.utils.unwrapObservable(data.path)}}},template=exports.template={eventIsButton:function(e){var $target=$(e.target);return $target.is("a")||$target.parentsUntil(".file, .folder").is("a")?!0:!1},mapFiles:function(){this.files(this.model.get("data"))},mapFolders:function(){var folders=[],self=this;this.foldersCollection.each(function(folder){var path=folder.get("path");if(path==="/")return;var prefix="/"+self.getPath("");if(path.indexOf(prefix)!==-1){var relPath=path.slice(prefix.length);if(relPath.length&&relPath.indexOf("/")===-1){var folderEntry=_.find(self.folders(),function(folder){return folder.path===path});folderEntry||(folder.urlRoot=self.foldersCollection.url,folderEntry={path:path,name:relPath,model:folder,isOpen:ko.observable(!1),viewModel:create(path)}),self.foldersToOpen[path]&&(folderEntry.isOpen(!0),delete self.foldersToOpen[path]),folders.push(folderEntry)}}}),self.folders(folders)},fetch:function(){this.fetchFiles(),this.fetchFolders(),_.each(this.folders(),function(f){f.isOpen()&&f.viewModel.fetch()})},fetchFolders:function(){this.foldersCollection.fetch()},fetchFiles:function(){this.model.fetch()},getPath:function(filename){var path=this.path.slice(1);return this.path!=="/"&&(path+="/"),path+filename},deleteFile:function(filename){var file=new File({path:this.path,info:{name:filename},id:filename}),self=this;file.destroy({success:function(){self.fetchFiles()}})},editFile:function(filename){app.set("new file",!1),app.set("files",this.getPath(filename))},onClickFile:function(filename,e){if(!!this.eventIsButton(e))return!0;this.editFile(filename)},onChangeUpload:function(data,e){var files=e.target.files&&e.target.files,self=this;_.each(files,self.uploadFile)},uploadFile:function(file){var f=new File({info:file,path:this.path}),name=file.name,self=this;this.uploadingFiles.push(name),f.on("sync",function(){self.fetchFiles(),self.uploadingFiles.remove(name)}),f.save()},addFile:function(){var name=prompt("Enter a name for this file, including the extension:");name&&(app.set("new file",!0),app.set("files",this.getPath(name)))},deleteFolder:function(folder){var self=this;folder.model.destroy({success:function(){self.fetchFolders()}})},addFolder:function(){var name=prompt("Enter a name for this folder:"),self=this;if(name){var resourcePath=Resource.sanitizePath(name);self.path!=="/"&&(resourcePath=self.path+resourcePath),this.foldersCollection.create({path:resourcePath,type:"Static"},{success:function(){self.foldersToOpen[resourcePath]=!0,self.fetchFolders()}})}},toggleFolder:function(folder){folder.isOpen(!folder.isOpen()),folder.isOpen()&&folder.viewModel.fetch()},onClickFolder:function(folder,e){if(!!this.eventIsButton(e))return!0;this.toggleFolder(folder)}},create=exports.create=function(path){path=path||"/";var self=Object.create(template);_.bindAll(self),self.path=path,self.model=new Backbone.Model,self.model.parse=parseModel,self.model.url=path,self.model.on("change:data",self.mapFiles,self);var foldersCollection=self.foldersCollection=new Backbone.Collection;return foldersCollection.url="/resources",foldersCollection.fetch=fetchFolders,foldersCollection.on("reset",self.mapFolders,self),self.foldersToOpen={},self.files=ko.observableArray(),self.folders=ko.observableArray(),self.uploadingFiles=ko.observableArray(),self.uploadingText=ko.computed(function(){var count=this.uploadingFiles().length;return count==1?"Uploading "+this.uploadingFiles()[0]+"...":count?"Uploading "+count+" files...":""},self),self}}),define("view/static-view",["require","exports","module","view-model/folder-view-model"],function(require,exports,module){var FolderViewModel=require("view-model/folder-view-model"),viewModelInstance,StaticView=module.exports=Backbone.View.extend({template:_.template($("#static-template").html()),initialize:function(){this.initializeViewModel(),this.render()},initializeViewModel:function(){viewModelInstance||(viewModelInstance=FolderViewModel.create()),this.viewModel=viewModelInstance,this.viewModel.fetch()},render:function(){this.$el.html(this.template({})),ko.cleanNode(this.el),ko.applyBindings(this.viewModel,this.el),prettyPrint()},close:function(){ko.removeNode(this.el)}})}),define("view/file-editor-view",["require","exports","module","../app","../model/file","./code-editor-view"],function(require,exports,module){var app=require("../app"),CodeEditorView=require("./code-editor-view"),File=require("../model/file"),saveStatus=require("./save-status-view"),FileEditorView=module.exports=Backbone.View.extend(Backbone.Events).extend({template:_.template($("#file-editor-template").html()),events:{"click .back":"back","click #save-btn":"save"},initialize:function(){$(this.el).html(this.template({}));var path=this.path="/"+app.get("files"),view=this,type=path.slice(path.indexOf(".")+1),editor=this.editor=(new CodeEditorView({el:$("#editor"),mode:type})).render();editor.updateTime=1,_.bind(view.save,view),editor.on("save",function(){view.save()}),editor.on("change",function(){view.hasChanges()});if(app.get("new file")){if(path.indexOf(".html")>-1||path.indexOf(".htm")>-1)editor.setText($("#empty-html-template").html().replace(/\n/,"").replace(/xscript/g,"script")),view.hasChanges()}else $.get(path,function(data){editor.setText(data)},"text"),view.saved();var container=$(".editor-container"),win=$(window);win.resize(function(){container.height(win.height()-200),editor.resize()}),win.resize()},back:function(){return app.set("files",!0),!1},save:function(){var file=new File({path:this.path,data:this.editor.getText()});file.save({},{success:function(){saveStatus.saved()}}),this.saved(),saveStatus.saving()},hasChanges:function(){$("#file-status").empty().append('<i class="icon-file"></i> '+this.link()+' <i class="icon-asterisk"></i>'),$("#save-btn").removeAttr("disabled")},link:function(){return'<a href="'+this.path+'" target="_blank">'+this.path+"</a>"},saved:function(){$("#file-status").empty().append('<i class="icon-file"></i> '+this.link()),$("#save-btn").attr("disabled",!0)},close:function(){this.editor.close()}})}),define("view/app-view",["require","exports","module","../app","../router","./undo-button-view","./save-status-view","../model/resource-collection","./auth-modal-view","./resource-sidebar-view","./resources-view","./header-view","./collection-view","./static-view","./file-editor-view"],function(require,exports,module){var app=require("../app"),router=require("../router"),undoBtn=require("./undo-button-view"),saveStatus=require("./save-status-view"),ResourceCollection=require("../model/resource-collection"),AuthModalView=require("./auth-modal-view"),ResourceSidebarView=require("./resource-sidebar-view"),ResourcesView=require("./resources-view"),HeaderView=require("./header-view"),CollectionView=require("./collection-view"),StaticView=require("./static-view"),FileEditorView=require("./file-editor-view"),AppView=module.exports=Backbone.View.extend({initialize:function(){this.resources=new ResourceCollection,this.modal=new AuthModalView,this.authenticate(),this.resources.fetch(),this.resources.on("reset",this.initRender,this),this.resources.on("error",this.modal.showError,this.modal)},authenticate:function(){this.resources.fetch()},initRender:function(){this.resourceSidebarView=new ResourceSidebarView({collection:this.resources}),this.resourceView=new ResourcesView({resources:this.resources}),this.headerView=new HeaderView({model:app}),this.resources.off("reset",this.initRender,this),app.on("change:resource",this.render,this),app.on("change:files",this.render,this),this.render()},render:function(){this.bodyView&&this.bodyView.close();var resource=app.get("resource"),files=app.get("files");if(app.get("resourceId")||files){var viewClass=null;if(files)files!==!0?viewClass=FileEditorView:viewClass=StaticView;else if(resource){var type=resource.get("type");if(type==="Collection"||type==="UserCollection")viewClass=CollectionView}if(viewClass){var el=$("<div>");$("#body").empty().append(el),this.bodyView=new viewClass({model:resource,el:el})}$("#body-container").show(),$("#resources-container").hide();if(files){var path="/files";files!==!0&&(path+="/"+files),router.navigate(path)}else router.navigate(app.get("resourceId"))}else $("#body-container").hide(),$("#resources-container").show(),this.resources.fetch(),router.navigate("");undoBtn.init(),saveStatus.init()}}),instance;AppView.init=function(){return instance||(instance=new AppView),instance}}),define("entry",["require","exports","module","./backbone-utils","./knockout-utils","./view/undo-button-view","./view/divider-drag","./view/app-view","./router"],function(require,exports,module){require("./backbone-utils"),require("./knockout-utils"),require("./view/undo-button-view"),require("./view/divider-drag");var AppView=require("./view/app-view"),router=require("./router");AppView.init(),Backbone.history.start()})